"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdateacfun_evolved"]("AcFun_Evolved",{

/***/ "./src/core/api/PluginToolkit.ts":
/*!***************************************!*\
  !*** ./src/core/api/PluginToolkit.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _Preferences__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Preferences */ \"./src/core/api/Preferences.ts\");\n/* harmony import */ var _Security__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Security */ \"./src/core/api/Security.ts\");\n/* harmony import */ var _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../plugins/ACEV2Toast */ \"./src/plugins/ACEV2Toast.ts\");\n/* harmony import */ var _plugins_ACEV2Dialog__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../plugins/ACEV2Dialog */ \"./src/plugins/ACEV2Dialog.ts\");\n/* harmony import */ var _I18n__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./I18n */ \"./src/core/api/I18n.ts\");\n/* harmony import */ var _services_ACEV2Storage__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../services/ACEV2Storage */ \"./src/core/services/ACEV2Storage.ts\");\n/* harmony import */ var _plugins_ACEV2Loader__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../plugins/ACEV2Loader */ \"./src/plugins/ACEV2Loader.ts\");\n/* harmony import */ var _Logger__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./Logger */ \"./src/core/api/Logger.ts\");\n/* harmony import */ var _ACEV2URL__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./ACEV2URL */ \"./src/core/api/ACEV2URL.ts\");\n/* harmony import */ var _Supervisor__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./Supervisor */ \"./src/core/api/Supervisor.ts\");\n/* harmony import */ var _plugins_PluginStore__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../plugins/PluginStore */ \"./src/plugins/PluginStore.ts\");\n/* harmony import */ var _plugins_DebugBridge__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../plugins/DebugBridge */ \"./src/plugins/DebugBridge.ts\");\n/* harmony import */ var pako__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! pako */ \"./node_modules/pako/dist/pako.esm.mjs\");\n/* harmony import */ var untar_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! untar.js */ \"./node_modules/untar.js/lib/untar.js\");\n/* harmony import */ var _ACEV2DOM__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./ACEV2DOM */ \"./src/core/api/ACEV2DOM.ts\");\n/* harmony import */ var _Variable__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./Variable */ \"./src/core/api/Variable.ts\");\n/* harmony import */ var _IO__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./IO */ \"./src/core/api/IO.ts\");\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (undefined && undefined.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar PluginToolkit = /** @class */ (function () {\n    function PluginToolkit() {\n        this.tombstones = [];\n        this.apiImplementations = {\n            showDialog: function (_a) {\n                var title = _a.title, content = _a.content, okAction = _a.okAction, cancelAction = _a.cancelAction;\n                return _plugins_ACEV2Dialog__WEBPACK_IMPORTED_MODULE_3__[\"default\"].showDialog({ title: title, content: content, okAction: okAction, cancelAction: cancelAction });\n            },\n            showToast: function (_a) {\n                var text = _a.text;\n                return _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: text });\n            },\n            aceLog: {\n                info: function (_a) {\n                    var message = _a.message;\n                    return _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].info({ message: message });\n                },\n                success: function (_a) {\n                    var message = _a.message;\n                    return _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].success({ message: message });\n                },\n                warn: function (_a) {\n                    var message = _a.message;\n                    return _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].warn({ message: message });\n                },\n                error: function (_a) {\n                    var message = _a.message;\n                    return _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].error({ message: message });\n                }\n            },\n            isDarkMode: function () { return _Preferences__WEBPACK_IMPORTED_MODULE_0__[\"default\"].isDarkMode(); },\n            ACEV2DOM: {\n                injectHTML: function (_a) {\n                    var HTMLCode = _a.HTMLCode;\n                    return _ACEV2DOM__WEBPACK_IMPORTED_MODULE_14__[\"default\"].injectHTML({ HTMLCode: HTMLCode });\n                },\n                removeHTML: function (_a) {\n                    var tracker = _a.tracker;\n                    return _ACEV2DOM__WEBPACK_IMPORTED_MODULE_14__[\"default\"].removeElement({ tracker: tracker });\n                }\n            }\n        };\n    }\n    PluginToolkit.prototype.installPlugin = function (_a) {\n        return __awaiter(this, arguments, void 0, function (_b) {\n            var psvResult, e_1, installedPlugins, existingPluginIndex, installedPlugins;\n            var pluginPack = _b.pluginPack, bridged = _b.bridged;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        psvResult = false;\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 5, , 6]);\n                        if (!(_Preferences__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getPreference({ category: 'developer', k: 'psv' }) !== 'none')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, _Security__WEBPACK_IMPORTED_MODULE_1__[\"default\"].psv({ signature: pluginPack.signature, pluginSelf: pluginPack.self })];\n                    case 2:\n                        psvResult = _c.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        psvResult = true;\n                        _c.label = 4;\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        e_1 = _c.sent();\n                        _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'psv-check-failed-installation-denied' }) });\n                        return [3 /*break*/, 6];\n                    case 6:\n                        if (!psvResult) {\n                            _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: \"\\u5B89\\u88C5\\u88AB\\u62D2\\u7EDD, \\u6B64\\u63D2\\u4EF6\\u300C\".concat(pluginPack.manifest.id, \"\\u300D\\u672A\\u901A\\u8FC7PSV\\u68C0\\u67E5\\u3002\") });\n                            return [2 /*return*/];\n                        }\n                        if (this.checkIfInstalled({ pluginPack: pluginPack })) {\n                            _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: \"\\u5B89\\u88C5\\u88AB\\u62D2\\u7EDD, \\u6B64\\u63D2\\u4EF6\\u300C\".concat(pluginPack.manifest.id, \"\\u300D\\u5DF2\\u7ECF\\u5B89\\u88C5\\u3002\") });\n                            return [2 /*return*/];\n                        }\n                        if (bridged) {\n                            installedPlugins = this.getInstalledPlugins();\n                            pluginPack.enabled = true;\n                            pluginPack.manifest.bridged = true;\n                            existingPluginIndex = installedPlugins.findIndex(function (plugin) { return plugin.manifest.id === pluginPack.manifest.id; });\n                            if (existingPluginIndex !== -1) {\n                                installedPlugins[existingPluginIndex] = pluginPack;\n                            }\n                            else {\n                                installedPlugins.push(pluginPack);\n                            }\n                            this.saveInstalledPlugins({ installedPlugins: installedPlugins });\n                        }\n                        else {\n                            installedPlugins = this.getInstalledPlugins();\n                            pluginPack.enabled = true;\n                            installedPlugins.push(pluginPack);\n                            this.saveInstalledPlugins({ installedPlugins: installedPlugins });\n                            console.log('---------------------------');\n                            _plugins_ACEV2Dialog__WEBPACK_IMPORTED_MODULE_3__[\"default\"].showDialog({\n                                title: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'installation-succeed' }),\n                                content: \"\\u6B64\\u63D2\\u4EF6\\u300C\".concat(pluginPack.manifest.id, \"\\u300D\\u5DF2\\u88AB\\u5B89\\u88C5\\uFF0C\\u6309\\u4E0B\\u300C\\u597D\\u300D\\u540E\\u5C06\\u5237\\u65B0\\u9875\\u9762\\u4EE5\\u8F7D\\u5165\\u63D2\\u4EF6\\u3002\"),\n                                okAction: function () {\n                                    location.reload();\n                                }\n                            });\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PluginToolkit.prototype.uninstallPlugin = function (_a) {\n        var manifest = _a.manifest;\n        var id = manifest.id;\n        _plugins_ACEV2Loader__WEBPACK_IMPORTED_MODULE_6__[\"default\"].draw();\n        try {\n            var installedPlugins = this.getInstalledPlugins();\n            var newInstalledPlugins = installedPlugins.filter(function (installedPlugin) { return installedPlugin.manifest.id !== id; });\n            this.saveInstalledPlugins({ installedPlugins: newInstalledPlugins });\n            _plugins_ACEV2Dialog__WEBPACK_IMPORTED_MODULE_3__[\"default\"].showDialog({\n                title: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'uninstallation-succeed' }),\n                content: \"\\u63D2\\u4EF6\\u300C\".concat(id, \"\\u300D\\u5378\\u8F7D\\u5B8C\\u6210\\uFF0C\\u70B9\\u51FB\\u300C\\u597D\\u300D\\u4EE5\\u5237\\u65B0\\u9875\\u9762\\u3002\"),\n                okAction: function () { return location.reload(); }\n            });\n        }\n        catch (e) {\n            _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: \"\\u63D2\\u4EF6\\u89E3\\u9664\\u5B89\\u88C5\\u5931\\u8D25\\uFF0C\\u5728\\u5C1D\\u8BD5\\u89E3\\u9664\\u5B89\\u88C5\\u63D2\\u4EF6\\u300C\".concat(id, \"\\u300D\\u65F6\\u51FA\\u73B0\\u9519\\u8BEF\\uFF0C\\u8BF7\\u518D\\u8BD5\\u4E00\\u6B21\\u3002\") });\n            _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].error({ message: JSON.stringify(e) });\n        }\n        _plugins_ACEV2Loader__WEBPACK_IMPORTED_MODULE_6__[\"default\"].destroy();\n    };\n    PluginToolkit.prototype.uninstallBridgedPlugin = function () {\n        var installedPlugins = this.getInstalledPlugins();\n        var bridgedPlugins = installedPlugins.filter(function (i) { return i.manifest.bridged === true; });\n        if (bridgedPlugins.length !== 0) {\n            var id_1 = bridgedPlugins[0].manifest.id;\n            if (id_1) {\n                try {\n                    var installedPlugins_1 = this.getInstalledPlugins();\n                    var newInstalledPlugins = installedPlugins_1.filter(function (installedPlugin) { return installedPlugin.manifest.id !== id_1; });\n                    this.saveInstalledPlugins({ installedPlugins: newInstalledPlugins });\n                    _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].success({ message: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'uninstalled-bridged-plugin' }) + id_1 });\n                    _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'uninstalled-bridged-plugin' }) + id_1 + _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'please-reload-page' }) });\n                }\n                catch (e) {\n                    _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'uninstall-bridged-plugin-failed' }) + id_1 + _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'please-try-again' }) });\n                    _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].error({ message: JSON.stringify(e) });\n                }\n            }\n        }\n    };\n    PluginToolkit.prototype.checkIfInstalled = function (_a) {\n        var pluginPack = _a.pluginPack;\n        var installedPlugins = this.getInstalledPlugins();\n        var isInstalled = false;\n        installedPlugins.forEach(function (installedPlugin) {\n            if (installedPlugin.manifest.id === pluginPack.manifest.id) {\n                isInstalled = true;\n            }\n        });\n        return isInstalled;\n    };\n    PluginToolkit.prototype.getInstalledPlugins = function () {\n        var installedPlugins = _services_ACEV2Storage__WEBPACK_IMPORTED_MODULE_5__[\"default\"].getPlugins();\n        if (!installedPlugins) {\n            installedPlugins = [];\n            this.saveInstalledPlugins({ installedPlugins: installedPlugins });\n        }\n        return installedPlugins;\n    };\n    PluginToolkit.prototype.saveInstalledPlugins = function (_a) {\n        var installedPlugins = _a.installedPlugins;\n        _services_ACEV2Storage__WEBPACK_IMPORTED_MODULE_5__[\"default\"].updatePluginsStorage({ newPlugins: installedPlugins });\n    };\n    PluginToolkit.prototype.getSelfPreference = function (_a) {\n        var manifest = _a.manifest;\n        var installedPlugins = this.getInstalledPlugins();\n        var targetPlugin = installedPlugins.find(function (installedPlugin) { return installedPlugin.manifest.id === manifest.id; });\n        return targetPlugin.manifest.settings;\n    };\n    PluginToolkit.prototype.saveSelfPreference = function (_a) {\n        var manifest = _a.manifest, settings = _a.settings;\n        var installedPlugins = this.getInstalledPlugins();\n        var targetPlugin = installedPlugins.find(function (installedPlugin) { return installedPlugin.manifest.id === manifest.id; });\n        targetPlugin.manifest.settings = settings;\n        this.saveInstalledPlugins({ installedPlugins: installedPlugins });\n    };\n    PluginToolkit.prototype.initializePluginExecutionAndSetTrigger = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var installedPlugins, __tombstones, _loop_1, _i, installedPlugins_2, installedPlugin;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        installedPlugins = this.getInstalledPlugins();\n                        __tombstones = [];\n                        if (installedPlugins.length === 0)\n                            return [2 /*return*/];\n                        _loop_1 = function (installedPlugin) {\n                            var self_1, manifest, allApisDefined, args, filteredArgs;\n                            return __generator(this, function (_b) {\n                                switch (_b.label) {\n                                    case 0:\n                                        if (!installedPlugin.enabled)\n                                            return [2 /*return*/, \"continue\"];\n                                        self_1 = installedPlugin.self, manifest = installedPlugin.manifest;\n                                        allApisDefined = true;\n                                        return [4 /*yield*/, Promise.all(manifest.requestedAPIs.map(function (apiName) { return __awaiter(_this, void 0, void 0, function () {\n                                                return __generator(this, function (_a) {\n                                                    if (this.apiImplementations[apiName]) {\n                                                        return [2 /*return*/, { name: apiName, target: this.apiImplementations[apiName] }];\n                                                    }\n                                                    else {\n                                                        _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].error({ message: \"Error loading plugin tombstone \".concat(manifest.id, \", cannot resolve API \").concat(apiName, \" of undefined.\") });\n                                                        _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: \"\\u63D2\\u4EF6\\u300C\".concat(manifest.id, \"\\u300D\\u8BF7\\u6C42\\u4E86\\u4E00\\u4E2A\\u672A\\u5B9A\\u4E49\\u7684API\\u300C\").concat(apiName, \"\\u300D\\uFF0C\\u56E0\\u6B64\\u62D2\\u7EDD\\u8F7D\\u5165\\u6B64\\u63D2\\u4EF6\\u3002\") });\n                                                        allApisDefined = false;\n                                                        return [2 /*return*/, undefined];\n                                                    }\n                                                    return [2 /*return*/];\n                                                });\n                                            }); }))];\n                                    case 1:\n                                        args = _b.sent();\n                                        if (!allApisDefined)\n                                            return [2 /*return*/, \"continue\"];\n                                        filteredArgs = args.filter(function (arg) { return arg !== undefined; });\n                                        if (filteredArgs.length === manifest.requestedAPIs.length) {\n                                            try {\n                                                __tombstones.push({\n                                                    self: self_1,\n                                                    manifest: manifest,\n                                                    args: filteredArgs,\n                                                    executed: false\n                                                });\n                                            }\n                                            catch (error) {\n                                                _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].error({ message: \"Error creating plugin tombstone \".concat(manifest.id, \": \").concat(JSON.stringify(error)) });\n                                                _plugins_ACEV2Dialog__WEBPACK_IMPORTED_MODULE_3__[\"default\"].showDialog({\n                                                    title: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'request-reload' }),\n                                                    content: \"\\u63D2\\u4EF6\\u8F7D\\u5165\\u5668\\u5728\\u751F\\u6210\\u63D2\\u4EF6\\u300C\".concat(manifest.id, \"\\u300D\\u7684\\u5893\\u7891\\u4E2D\\u51FA\\u73B0\\u9519\\u8BEF\").concat(error, \"\\uFF0C\\u56E0\\u6B64AcFun Evolved\\u5DF2\\u4E2D\\u6B62\\u8FD0\\u884C\\uFF0C\\u6309\\u4E0B\\u300C\\u597D\\u300D\\u4EE5\\u91CD\\u65B0\\u542F\\u52A8AcFun Evolved.\"),\n                                                    okAction: function () { return location.reload(); }\n                                                });\n                                            }\n                                        }\n                                        return [2 /*return*/];\n                                }\n                            });\n                        };\n                        _i = 0, installedPlugins_2 = installedPlugins;\n                        _a.label = 1;\n                    case 1:\n                        if (!(_i < installedPlugins_2.length)) return [3 /*break*/, 4];\n                        installedPlugin = installedPlugins_2[_i];\n                        return [5 /*yield**/, _loop_1(installedPlugin)];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3:\n                        _i++;\n                        return [3 /*break*/, 1];\n                    case 4:\n                        this.tombstones = __tombstones;\n                        return [4 /*yield*/, this.ferryman()];\n                    case 5:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ;\n    PluginToolkit.prototype.ferryman = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var executeTombstones;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        executeTombstones = function (_a) { return __awaiter(_this, [_a], void 0, function (_b) {\n                            var __tombstones, _i, __tombstones_1, tombstone, self_2, args, manifest, requiredPatterns, isMatch, targetFunction;\n                            var _this = this;\n                            var currentUrl = _b.currentUrl;\n                            return __generator(this, function (_c) {\n                                __tombstones = this.tombstones;\n                                for (_i = 0, __tombstones_1 = __tombstones; _i < __tombstones_1.length; _i++) {\n                                    tombstone = __tombstones_1[_i];\n                                    if (tombstone.executed)\n                                        continue;\n                                    self_2 = tombstone.self, args = tombstone.args, manifest = tombstone.manifest;\n                                    if (manifest.trigger.matches && manifest.trigger.matches.length > 0) {\n                                        requiredPatterns = manifest.trigger.matches.flatMap(function (key) { return _ACEV2URL__WEBPACK_IMPORTED_MODULE_8__.pageList[key] || []; });\n                                        isMatch = requiredPatterns.some(function (pattern) { return pattern.test(currentUrl); });\n                                        if (isMatch) {\n                                            try {\n                                                _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].info({ message: \"executed \".concat(manifest.id) });\n                                                targetFunction = new (Function.bind.apply(Function, __spreadArray(__spreadArray([void 0], args.map(function (arg) { return arg.name; }), false), ['manifest', 'getSelfPreference', self_2], false)))();\n                                                // const targetFunction = new Function(...args.map((arg: any) => arg.name), 'manifest', `(()=>{\"use strict\";(async()=>{console.log('-------------------')})();`);\n                                                targetFunction.apply(void 0, __spreadArray(__spreadArray([], args.map(function (arg) { return arg.target; }), false), [manifest, function (_a) {\n                                                        var manifest = _a.manifest;\n                                                        return _this.getSelfPreference({ manifest: manifest });\n                                                    }], false));\n                                                tombstone.executed = true;\n                                            }\n                                            catch (e) {\n                                                _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].error({ message: \"Error ferrying plugin \".concat(manifest.id, \": \").concat(JSON.stringify(e)) });\n                                                _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: \"\\u6446\\u6E21\\u4EBA\\u5728\\u6267\\u884C\\u63D2\\u4EF6\\u300C\".concat(manifest.id, \"\\u300D\\u4E2D\\u51FA\\u73B0\\u9519\\u8BEF\").concat(JSON.stringify(e), \"\\uFF0C\\u56E0\\u6B64\\u5DF2\\u4E2D\\u6B62\\u8FD0\\u884C\\u6B64\\u63D2\\u4EF6\\u3002\") });\n                                            }\n                                        }\n                                    }\n                                }\n                                this.tombstones = __tombstones;\n                                return [2 /*return*/];\n                            });\n                        }); };\n                        return [4 /*yield*/, executeTombstones({ currentUrl: window.location.href })];\n                    case 1:\n                        _a.sent();\n                        _Supervisor__WEBPACK_IMPORTED_MODULE_9__[\"default\"].urlChange(function (currentUrl) { return __awaiter(_this, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, executeTombstones({ currentUrl: currentUrl })];\n                                    case 1:\n                                        _a.sent();\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ;\n    PluginToolkit.prototype.wakeUpBuildInPlugins = function () {\n        if (_Preferences__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getPreference({ category: 'developer', k: 'psv' }) !== 'full') {\n            _plugins_DebugBridge__WEBPACK_IMPORTED_MODULE_11__[\"default\"].wakeUp();\n        }\n        _plugins_PluginStore__WEBPACK_IMPORTED_MODULE_10__[\"default\"].wakeUp();\n    };\n    PluginToolkit.prototype.extractAndInstallPlugin = function (_a) {\n        var _this = this;\n        var compressedData = _a.compressedData;\n        _plugins_ACEV2Dialog__WEBPACK_IMPORTED_MODULE_3__[\"default\"].showDialog({\n            title: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'wants-to-extract-and-install-plugin-package' }) }),\n            content: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'do-you-really-want-to-do-that' }),\n            okAction: function () { return __awaiter(_this, void 0, void 0, function () {\n                var decompressedArrayBuffer, files, rawObject, pack, err_1;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            _plugins_ACEV2Loader__WEBPACK_IMPORTED_MODULE_6__[\"default\"].draw();\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, 3, , 4]);\n                            decompressedArrayBuffer = pako__WEBPACK_IMPORTED_MODULE_12__[\"default\"].inflate(new Uint8Array(compressedData));\n                            if (!decompressedArrayBuffer.buffer) {\n                                _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'decompressed-data-does-not-contain-valid-buffer-property' }) });\n                                return [2 /*return*/];\n                            }\n                            files = (0,untar_js__WEBPACK_IMPORTED_MODULE_13__.untar)(decompressedArrayBuffer.buffer);\n                            if (!files || files.length === 0) {\n                                _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'no-files-extracted-from-the-compressed-data' }) });\n                                return [2 /*return*/];\n                            }\n                            rawObject = files[0];\n                            rawObject = new TextDecoder().decode(rawObject.fileData);\n                            pack = JSON.parse(rawObject);\n                            return [4 /*yield*/, this.installPlugin({ pluginPack: pack, bridged: false })];\n                        case 2:\n                            _a.sent();\n                            return [3 /*break*/, 4];\n                        case 3:\n                            err_1 = _a.sent();\n                            _Logger__WEBPACK_IMPORTED_MODULE_7__[\"default\"].error({ message: \"Error extracting and installing plugin package: \".concat(JSON.stringify(err_1)) });\n                            _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'error-extracting-and-installing-plugin-package' }) });\n                            return [3 /*break*/, 4];\n                        case 4:\n                            _plugins_ACEV2Loader__WEBPACK_IMPORTED_MODULE_6__[\"default\"].destroy();\n                            return [2 /*return*/];\n                    }\n                });\n            }); },\n            cancelAction: function () { return _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: 'canceled' }); }\n        });\n    };\n    ;\n    PluginToolkit.prototype.downloadAndInstallPluginPack = function (_a) {\n        var _this = this;\n        var manifest = _a.manifest;\n        var fullDownloadUrl = _Variable__WEBPACK_IMPORTED_MODULE_15__[\"default\"].pluginDownloadURL({ manifest: manifest });\n        _plugins_ACEV2Dialog__WEBPACK_IMPORTED_MODULE_3__[\"default\"].showDialog({\n            title: _Variable__WEBPACK_IMPORTED_MODULE_15__[\"default\"].MASTER_MANIFEST.id + ' ' + _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'wants-to-download-and-install-plugin-package' }),\n            content: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'download-url' }) + ': [' + fullDownloadUrl + '] | ' + _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'target-plugin-id' }) + manifest.id,\n            okAction: function () { return __awaiter(_this, void 0, void 0, function () {\n                var compressedPack, decompressedContent, files, rawObject, pack, err_2;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            _plugins_ACEV2Loader__WEBPACK_IMPORTED_MODULE_6__[\"default\"].draw();\n                            return [4 /*yield*/, _IO__WEBPACK_IMPORTED_MODULE_16__[\"default\"].monkey({\n                                    method: 'GET',\n                                    url: fullDownloadUrl,\n                                    responseType: 'arraybuffer'\n                                })];\n                        case 1:\n                            compressedPack = _a.sent();\n                            _a.label = 2;\n                        case 2:\n                            _a.trys.push([2, 4, , 5]);\n                            decompressedContent = pako__WEBPACK_IMPORTED_MODULE_12__[\"default\"].inflate(compressedPack);\n                            files = (0,untar_js__WEBPACK_IMPORTED_MODULE_13__.untar)(decompressedContent);\n                            rawObject = files[0];\n                            pack = JSON.parse(new TextDecoder().decode(rawObject.fileData));\n                            return [4 /*yield*/, this.installPlugin({ pluginPack: pack, bridged: false })];\n                        case 3:\n                            _a.sent();\n                            return [3 /*break*/, 5];\n                        case 4:\n                            err_2 = _a.sent();\n                            _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'error-extracting-and-installing-plugin-package' }) });\n                            console.error('解压缩失败', err_2);\n                            return [3 /*break*/, 5];\n                        case 5:\n                            _plugins_ACEV2Loader__WEBPACK_IMPORTED_MODULE_6__[\"default\"].destroy();\n                            return [2 /*return*/];\n                    }\n                });\n            }); },\n            cancelAction: function () { return _plugins_ACEV2Toast__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showToast({ text: _I18n__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t({ key: 'canceled' }) }); }\n        });\n    };\n    return PluginToolkit;\n}());\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (new PluginToolkit());\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Olsid2VicGFjazovL2FjZnVuX2V2b2x2ZWQvLi9zcmMvY29yZS9hcGkvUGx1Z2luVG9vbGtpdC50cz9mNmEzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHtcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xuICAgICAgICB3aGlsZSAoZyAmJiAoZyA9IDAsIG9wWzBdICYmIChfID0gMCkpLCBfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbnZhciBfX3NwcmVhZEFycmF5ID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5KSB8fCBmdW5jdGlvbiAodG8sIGZyb20sIHBhY2spIHtcbiAgICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XG4gICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpO1xuICAgICAgICAgICAgYXJbaV0gPSBmcm9tW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpO1xufTtcbmltcG9ydCBQcmVmZXJlbmNlcyBmcm9tIFwiLi9QcmVmZXJlbmNlc1wiO1xuaW1wb3J0IFNlY3VyaXR5IGZyb20gXCIuL1NlY3VyaXR5XCI7XG5pbXBvcnQgQUNFVjJUb2FzdCBmcm9tIFwiLi4vLi4vcGx1Z2lucy9BQ0VWMlRvYXN0XCI7XG5pbXBvcnQgQUNFVjJEaWFsb2cgZnJvbSBcIi4uLy4uL3BsdWdpbnMvQUNFVjJEaWFsb2dcIjtcbmltcG9ydCBJMThuIGZyb20gXCIuL0kxOG5cIjtcbmltcG9ydCBBQ0VWMlN0b3JhZ2UgZnJvbSBcIi4uL3NlcnZpY2VzL0FDRVYyU3RvcmFnZVwiO1xuaW1wb3J0IEFDRVYyTG9hZGVyIGZyb20gXCIuLi8uLi9wbHVnaW5zL0FDRVYyTG9hZGVyXCI7XG5pbXBvcnQgTG9nZ2VyIGZyb20gXCIuL0xvZ2dlclwiO1xuaW1wb3J0IHsgcGFnZUxpc3QgfSBmcm9tIFwiLi9BQ0VWMlVSTFwiO1xuaW1wb3J0IFN1cGVydmlzb3IgZnJvbSBcIi4vU3VwZXJ2aXNvclwiO1xuaW1wb3J0IFBsdWdpblN0b3JlIGZyb20gXCIuLi8uLi9wbHVnaW5zL1BsdWdpblN0b3JlXCI7XG5pbXBvcnQgRGVidWdCcmlkZ2UgZnJvbSBcIi4uLy4uL3BsdWdpbnMvRGVidWdCcmlkZ2VcIjtcbmltcG9ydCBwYWtvIGZyb20gXCJwYWtvXCI7XG5pbXBvcnQgeyB1bnRhciB9IGZyb20gXCJ1bnRhci5qc1wiO1xuaW1wb3J0IEFDRVYyRE9NIGZyb20gXCIuL0FDRVYyRE9NXCI7XG5pbXBvcnQgVmFyaWFibGUgZnJvbSBcIi4vVmFyaWFibGVcIjtcbmltcG9ydCBJTyBmcm9tIFwiLi9JT1wiO1xudmFyIFBsdWdpblRvb2xraXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUGx1Z2luVG9vbGtpdCgpIHtcbiAgICAgICAgdGhpcy50b21ic3RvbmVzID0gW107XG4gICAgICAgIHRoaXMuYXBpSW1wbGVtZW50YXRpb25zID0ge1xuICAgICAgICAgICAgc2hvd0RpYWxvZzogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gX2EudGl0bGUsIGNvbnRlbnQgPSBfYS5jb250ZW50LCBva0FjdGlvbiA9IF9hLm9rQWN0aW9uLCBjYW5jZWxBY3Rpb24gPSBfYS5jYW5jZWxBY3Rpb247XG4gICAgICAgICAgICAgICAgcmV0dXJuIEFDRVYyRGlhbG9nLnNob3dEaWFsb2coeyB0aXRsZTogdGl0bGUsIGNvbnRlbnQ6IGNvbnRlbnQsIG9rQWN0aW9uOiBva0FjdGlvbiwgY2FuY2VsQWN0aW9uOiBjYW5jZWxBY3Rpb24gfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd1RvYXN0OiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IF9hLnRleHQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEFDRVYyVG9hc3Quc2hvd1RvYXN0KHsgdGV4dDogdGV4dCB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhY2VMb2c6IHtcbiAgICAgICAgICAgICAgICBpbmZvOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBfYS5tZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTG9nZ2VyLmluZm8oeyBtZXNzYWdlOiBtZXNzYWdlIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gX2EubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIExvZ2dlci5zdWNjZXNzKHsgbWVzc2FnZTogbWVzc2FnZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHdhcm46IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IF9hLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBMb2dnZXIud2Fybih7IG1lc3NhZ2U6IG1lc3NhZ2UgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gX2EubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIExvZ2dlci5lcnJvcih7IG1lc3NhZ2U6IG1lc3NhZ2UgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzRGFya01vZGU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFByZWZlcmVuY2VzLmlzRGFya01vZGUoKTsgfSxcbiAgICAgICAgICAgIEFDRVYyRE9NOiB7XG4gICAgICAgICAgICAgICAgaW5qZWN0SFRNTDogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBIVE1MQ29kZSA9IF9hLkhUTUxDb2RlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gQUNFVjJET00uaW5qZWN0SFRNTCh7IEhUTUxDb2RlOiBIVE1MQ29kZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlbW92ZUhUTUw6IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhY2tlciA9IF9hLnRyYWNrZXI7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBBQ0VWMkRPTS5yZW1vdmVFbGVtZW50KHsgdHJhY2tlcjogdHJhY2tlciB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIFBsdWdpblRvb2xraXQucHJvdG90eXBlLmluc3RhbGxQbHVnaW4gPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCBhcmd1bWVudHMsIHZvaWQgMCwgZnVuY3Rpb24gKF9iKSB7XG4gICAgICAgICAgICB2YXIgcHN2UmVzdWx0LCBlXzEsIGluc3RhbGxlZFBsdWdpbnMsIGV4aXN0aW5nUGx1Z2luSW5kZXgsIGluc3RhbGxlZFBsdWdpbnM7XG4gICAgICAgICAgICB2YXIgcGx1Z2luUGFjayA9IF9iLnBsdWdpblBhY2ssIGJyaWRnZWQgPSBfYi5icmlkZ2VkO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2MubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgcHN2UmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYy5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jLnRyeXMucHVzaChbMSwgNSwgLCA2XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShQcmVmZXJlbmNlcy5nZXRQcmVmZXJlbmNlKHsgY2F0ZWdvcnk6ICdkZXZlbG9wZXInLCBrOiAncHN2JyB9KSAhPT0gJ25vbmUnKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBTZWN1cml0eS5wc3YoeyBzaWduYXR1cmU6IHBsdWdpblBhY2suc2lnbmF0dXJlLCBwbHVnaW5TZWxmOiBwbHVnaW5QYWNrLnNlbGYgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBwc3ZSZXN1bHQgPSBfYy5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgcHN2UmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jLmxhYmVsID0gNDtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OiByZXR1cm4gWzMgLypicmVhayovLCA2XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgZV8xID0gX2Muc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgQUNFVjJUb2FzdC5zaG93VG9hc3QoeyB0ZXh0OiBJMThuLnQoeyBrZXk6ICdwc3YtY2hlY2stZmFpbGVkLWluc3RhbGxhdGlvbi1kZW5pZWQnIH0pIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNl07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHN2UmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQUNFVjJUb2FzdC5zaG93VG9hc3QoeyB0ZXh0OiBcIlxcdTVCODlcXHU4OEM1XFx1ODhBQlxcdTYyRDJcXHU3RURELCBcXHU2QjY0XFx1NjNEMlxcdTRFRjZcXHUzMDBDXCIuY29uY2F0KHBsdWdpblBhY2subWFuaWZlc3QuaWQsIFwiXFx1MzAwRFxcdTY3MkFcXHU5MDFBXFx1OEZDN1BTVlxcdTY4QzBcXHU2N0U1XFx1MzAwMlwiKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja0lmSW5zdGFsbGVkKHsgcGx1Z2luUGFjazogcGx1Z2luUGFjayB9KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDRVYyVG9hc3Quc2hvd1RvYXN0KHsgdGV4dDogXCJcXHU1Qjg5XFx1ODhDNVxcdTg4QUJcXHU2MkQyXFx1N0VERCwgXFx1NkI2NFxcdTYzRDJcXHU0RUY2XFx1MzAwQ1wiLmNvbmNhdChwbHVnaW5QYWNrLm1hbmlmZXN0LmlkLCBcIlxcdTMwMERcXHU1REYyXFx1N0VDRlxcdTVCODlcXHU4OEM1XFx1MzAwMlwiKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnJpZGdlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbGxlZFBsdWdpbnMgPSB0aGlzLmdldEluc3RhbGxlZFBsdWdpbnMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW5QYWNrLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsdWdpblBhY2subWFuaWZlc3QuYnJpZGdlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdQbHVnaW5JbmRleCA9IGluc3RhbGxlZFBsdWdpbnMuZmluZEluZGV4KGZ1bmN0aW9uIChwbHVnaW4pIHsgcmV0dXJuIHBsdWdpbi5tYW5pZmVzdC5pZCA9PT0gcGx1Z2luUGFjay5tYW5pZmVzdC5pZDsgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nUGx1Z2luSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbGxlZFBsdWdpbnNbZXhpc3RpbmdQbHVnaW5JbmRleF0gPSBwbHVnaW5QYWNrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbGVkUGx1Z2lucy5wdXNoKHBsdWdpblBhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVJbnN0YWxsZWRQbHVnaW5zKHsgaW5zdGFsbGVkUGx1Z2luczogaW5zdGFsbGVkUGx1Z2lucyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbGxlZFBsdWdpbnMgPSB0aGlzLmdldEluc3RhbGxlZFBsdWdpbnMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW5QYWNrLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbGxlZFBsdWdpbnMucHVzaChwbHVnaW5QYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVJbnN0YWxsZWRQbHVnaW5zKHsgaW5zdGFsbGVkUGx1Z2luczogaW5zdGFsbGVkUGx1Z2lucyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQUNFVjJEaWFsb2cuc2hvd0RpYWxvZyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBJMThuLnQoeyBrZXk6ICdpbnN0YWxsYXRpb24tc3VjY2VlZCcgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFwiXFx1NkI2NFxcdTYzRDJcXHU0RUY2XFx1MzAwQ1wiLmNvbmNhdChwbHVnaW5QYWNrLm1hbmlmZXN0LmlkLCBcIlxcdTMwMERcXHU1REYyXFx1ODhBQlxcdTVCODlcXHU4OEM1XFx1RkYwQ1xcdTYzMDlcXHU0RTBCXFx1MzAwQ1xcdTU5N0RcXHUzMDBEXFx1NTQwRVxcdTVDMDZcXHU1MjM3XFx1NjVCMFxcdTk4NzVcXHU5NzYyXFx1NEVFNVxcdThGN0RcXHU1MTY1XFx1NjNEMlxcdTRFRjZcXHUzMDAyXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBva0FjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQbHVnaW5Ub29sa2l0LnByb3RvdHlwZS51bmluc3RhbGxQbHVnaW4gPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyIG1hbmlmZXN0ID0gX2EubWFuaWZlc3Q7XG4gICAgICAgIHZhciBpZCA9IG1hbmlmZXN0LmlkO1xuICAgICAgICBBQ0VWMkxvYWRlci5kcmF3KCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFsbGVkUGx1Z2lucyA9IHRoaXMuZ2V0SW5zdGFsbGVkUGx1Z2lucygpO1xuICAgICAgICAgICAgdmFyIG5ld0luc3RhbGxlZFBsdWdpbnMgPSBpbnN0YWxsZWRQbHVnaW5zLmZpbHRlcihmdW5jdGlvbiAoaW5zdGFsbGVkUGx1Z2luKSB7IHJldHVybiBpbnN0YWxsZWRQbHVnaW4ubWFuaWZlc3QuaWQgIT09IGlkOyB9KTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZUluc3RhbGxlZFBsdWdpbnMoeyBpbnN0YWxsZWRQbHVnaW5zOiBuZXdJbnN0YWxsZWRQbHVnaW5zIH0pO1xuICAgICAgICAgICAgQUNFVjJEaWFsb2cuc2hvd0RpYWxvZyh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IEkxOG4udCh7IGtleTogJ3VuaW5zdGFsbGF0aW9uLXN1Y2NlZWQnIH0pLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFwiXFx1NjNEMlxcdTRFRjZcXHUzMDBDXCIuY29uY2F0KGlkLCBcIlxcdTMwMERcXHU1Mzc4XFx1OEY3RFxcdTVCOENcXHU2MjEwXFx1RkYwQ1xcdTcwQjlcXHU1MUZCXFx1MzAwQ1xcdTU5N0RcXHUzMDBEXFx1NEVFNVxcdTUyMzdcXHU2NUIwXFx1OTg3NVxcdTk3NjJcXHUzMDAyXCIpLFxuICAgICAgICAgICAgICAgIG9rQWN0aW9uOiBmdW5jdGlvbiAoKSB7IHJldHVybiBsb2NhdGlvbi5yZWxvYWQoKTsgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIEFDRVYyVG9hc3Quc2hvd1RvYXN0KHsgdGV4dDogXCJcXHU2M0QyXFx1NEVGNlxcdTg5RTNcXHU5NjY0XFx1NUI4OVxcdTg4QzVcXHU1OTMxXFx1OEQyNVxcdUZGMENcXHU1NzI4XFx1NUMxRFxcdThCRDVcXHU4OUUzXFx1OTY2NFxcdTVCODlcXHU4OEM1XFx1NjNEMlxcdTRFRjZcXHUzMDBDXCIuY29uY2F0KGlkLCBcIlxcdTMwMERcXHU2NUY2XFx1NTFGQVxcdTczQjBcXHU5NTE5XFx1OEJFRlxcdUZGMENcXHU4QkY3XFx1NTE4RFxcdThCRDVcXHU0RTAwXFx1NkIyMVxcdTMwMDJcIikgfSk7XG4gICAgICAgICAgICBMb2dnZXIuZXJyb3IoeyBtZXNzYWdlOiBKU09OLnN0cmluZ2lmeShlKSB9KTtcbiAgICAgICAgfVxuICAgICAgICBBQ0VWMkxvYWRlci5kZXN0cm95KCk7XG4gICAgfTtcbiAgICBQbHVnaW5Ub29sa2l0LnByb3RvdHlwZS51bmluc3RhbGxCcmlkZ2VkUGx1Z2luID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaW5zdGFsbGVkUGx1Z2lucyA9IHRoaXMuZ2V0SW5zdGFsbGVkUGx1Z2lucygpO1xuICAgICAgICB2YXIgYnJpZGdlZFBsdWdpbnMgPSBpbnN0YWxsZWRQbHVnaW5zLmZpbHRlcihmdW5jdGlvbiAoaSkgeyByZXR1cm4gaS5tYW5pZmVzdC5icmlkZ2VkID09PSB0cnVlOyB9KTtcbiAgICAgICAgaWYgKGJyaWRnZWRQbHVnaW5zLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgdmFyIGlkXzEgPSBicmlkZ2VkUGx1Z2luc1swXS5tYW5pZmVzdC5pZDtcbiAgICAgICAgICAgIGlmIChpZF8xKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbGxlZFBsdWdpbnNfMSA9IHRoaXMuZ2V0SW5zdGFsbGVkUGx1Z2lucygpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3SW5zdGFsbGVkUGx1Z2lucyA9IGluc3RhbGxlZFBsdWdpbnNfMS5maWx0ZXIoZnVuY3Rpb24gKGluc3RhbGxlZFBsdWdpbikgeyByZXR1cm4gaW5zdGFsbGVkUGx1Z2luLm1hbmlmZXN0LmlkICE9PSBpZF8xOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlSW5zdGFsbGVkUGx1Z2lucyh7IGluc3RhbGxlZFBsdWdpbnM6IG5ld0luc3RhbGxlZFBsdWdpbnMgfSk7XG4gICAgICAgICAgICAgICAgICAgIExvZ2dlci5zdWNjZXNzKHsgbWVzc2FnZTogSTE4bi50KHsga2V5OiAndW5pbnN0YWxsZWQtYnJpZGdlZC1wbHVnaW4nIH0pICsgaWRfMSB9KTtcbiAgICAgICAgICAgICAgICAgICAgQUNFVjJUb2FzdC5zaG93VG9hc3QoeyB0ZXh0OiBJMThuLnQoeyBrZXk6ICd1bmluc3RhbGxlZC1icmlkZ2VkLXBsdWdpbicgfSkgKyBpZF8xICsgSTE4bi50KHsga2V5OiAncGxlYXNlLXJlbG9hZC1wYWdlJyB9KSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgQUNFVjJUb2FzdC5zaG93VG9hc3QoeyB0ZXh0OiBJMThuLnQoeyBrZXk6ICd1bmluc3RhbGwtYnJpZGdlZC1wbHVnaW4tZmFpbGVkJyB9KSArIGlkXzEgKyBJMThuLnQoeyBrZXk6ICdwbGVhc2UtdHJ5LWFnYWluJyB9KSB9KTtcbiAgICAgICAgICAgICAgICAgICAgTG9nZ2VyLmVycm9yKHsgbWVzc2FnZTogSlNPTi5zdHJpbmdpZnkoZSkgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBQbHVnaW5Ub29sa2l0LnByb3RvdHlwZS5jaGVja0lmSW5zdGFsbGVkID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciBwbHVnaW5QYWNrID0gX2EucGx1Z2luUGFjaztcbiAgICAgICAgdmFyIGluc3RhbGxlZFBsdWdpbnMgPSB0aGlzLmdldEluc3RhbGxlZFBsdWdpbnMoKTtcbiAgICAgICAgdmFyIGlzSW5zdGFsbGVkID0gZmFsc2U7XG4gICAgICAgIGluc3RhbGxlZFBsdWdpbnMuZm9yRWFjaChmdW5jdGlvbiAoaW5zdGFsbGVkUGx1Z2luKSB7XG4gICAgICAgICAgICBpZiAoaW5zdGFsbGVkUGx1Z2luLm1hbmlmZXN0LmlkID09PSBwbHVnaW5QYWNrLm1hbmlmZXN0LmlkKSB7XG4gICAgICAgICAgICAgICAgaXNJbnN0YWxsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGlzSW5zdGFsbGVkO1xuICAgIH07XG4gICAgUGx1Z2luVG9vbGtpdC5wcm90b3R5cGUuZ2V0SW5zdGFsbGVkUGx1Z2lucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGluc3RhbGxlZFBsdWdpbnMgPSBBQ0VWMlN0b3JhZ2UuZ2V0UGx1Z2lucygpO1xuICAgICAgICBpZiAoIWluc3RhbGxlZFBsdWdpbnMpIHtcbiAgICAgICAgICAgIGluc3RhbGxlZFBsdWdpbnMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZUluc3RhbGxlZFBsdWdpbnMoeyBpbnN0YWxsZWRQbHVnaW5zOiBpbnN0YWxsZWRQbHVnaW5zIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbnN0YWxsZWRQbHVnaW5zO1xuICAgIH07XG4gICAgUGx1Z2luVG9vbGtpdC5wcm90b3R5cGUuc2F2ZUluc3RhbGxlZFBsdWdpbnMgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyIGluc3RhbGxlZFBsdWdpbnMgPSBfYS5pbnN0YWxsZWRQbHVnaW5zO1xuICAgICAgICBBQ0VWMlN0b3JhZ2UudXBkYXRlUGx1Z2luc1N0b3JhZ2UoeyBuZXdQbHVnaW5zOiBpbnN0YWxsZWRQbHVnaW5zIH0pO1xuICAgIH07XG4gICAgUGx1Z2luVG9vbGtpdC5wcm90b3R5cGUuZ2V0U2VsZlByZWZlcmVuY2UgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyIG1hbmlmZXN0ID0gX2EubWFuaWZlc3Q7XG4gICAgICAgIHZhciBpbnN0YWxsZWRQbHVnaW5zID0gdGhpcy5nZXRJbnN0YWxsZWRQbHVnaW5zKCk7XG4gICAgICAgIHZhciB0YXJnZXRQbHVnaW4gPSBpbnN0YWxsZWRQbHVnaW5zLmZpbmQoZnVuY3Rpb24gKGluc3RhbGxlZFBsdWdpbikgeyByZXR1cm4gaW5zdGFsbGVkUGx1Z2luLm1hbmlmZXN0LmlkID09PSBtYW5pZmVzdC5pZDsgfSk7XG4gICAgICAgIHJldHVybiB0YXJnZXRQbHVnaW4ubWFuaWZlc3Quc2V0dGluZ3M7XG4gICAgfTtcbiAgICBQbHVnaW5Ub29sa2l0LnByb3RvdHlwZS5zYXZlU2VsZlByZWZlcmVuY2UgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyIG1hbmlmZXN0ID0gX2EubWFuaWZlc3QsIHNldHRpbmdzID0gX2Euc2V0dGluZ3M7XG4gICAgICAgIHZhciBpbnN0YWxsZWRQbHVnaW5zID0gdGhpcy5nZXRJbnN0YWxsZWRQbHVnaW5zKCk7XG4gICAgICAgIHZhciB0YXJnZXRQbHVnaW4gPSBpbnN0YWxsZWRQbHVnaW5zLmZpbmQoZnVuY3Rpb24gKGluc3RhbGxlZFBsdWdpbikgeyByZXR1cm4gaW5zdGFsbGVkUGx1Z2luLm1hbmlmZXN0LmlkID09PSBtYW5pZmVzdC5pZDsgfSk7XG4gICAgICAgIHRhcmdldFBsdWdpbi5tYW5pZmVzdC5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgICB0aGlzLnNhdmVJbnN0YWxsZWRQbHVnaW5zKHsgaW5zdGFsbGVkUGx1Z2luczogaW5zdGFsbGVkUGx1Z2lucyB9KTtcbiAgICB9O1xuICAgIFBsdWdpblRvb2xraXQucHJvdG90eXBlLmluaXRpYWxpemVQbHVnaW5FeGVjdXRpb25BbmRTZXRUcmlnZ2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFsbGVkUGx1Z2lucywgX190b21ic3RvbmVzLCBfbG9vcF8xLCBfaSwgaW5zdGFsbGVkUGx1Z2luc18yLCBpbnN0YWxsZWRQbHVnaW47XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbGVkUGx1Z2lucyA9IHRoaXMuZ2V0SW5zdGFsbGVkUGx1Z2lucygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX190b21ic3RvbmVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdGFsbGVkUGx1Z2lucy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2xvb3BfMSA9IGZ1bmN0aW9uIChpbnN0YWxsZWRQbHVnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZl8xLCBtYW5pZmVzdCwgYWxsQXBpc0RlZmluZWQsIGFyZ3MsIGZpbHRlcmVkQXJncztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9iKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2IubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluc3RhbGxlZFBsdWdpbi5lbmFibGVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgXCJjb250aW51ZVwiXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmXzEgPSBpbnN0YWxsZWRQbHVnaW4uc2VsZiwgbWFuaWZlc3QgPSBpbnN0YWxsZWRQbHVnaW4ubWFuaWZlc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsQXBpc0RlZmluZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIFByb21pc2UuYWxsKG1hbmlmZXN0LnJlcXVlc3RlZEFQSXMubWFwKGZ1bmN0aW9uIChhcGlOYW1lKSB7IHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBpSW1wbGVtZW50YXRpb25zW2FwaU5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB7IG5hbWU6IGFwaU5hbWUsIHRhcmdldDogdGhpcy5hcGlJbXBsZW1lbnRhdGlvbnNbYXBpTmFtZV0gfV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dnZXIuZXJyb3IoeyBtZXNzYWdlOiBcIkVycm9yIGxvYWRpbmcgcGx1Z2luIHRvbWJzdG9uZSBcIi5jb25jYXQobWFuaWZlc3QuaWQsIFwiLCBjYW5ub3QgcmVzb2x2ZSBBUEkgXCIpLmNvbmNhdChhcGlOYW1lLCBcIiBvZiB1bmRlZmluZWQuXCIpIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBQ0VWMlRvYXN0LnNob3dUb2FzdCh7IHRleHQ6IFwiXFx1NjNEMlxcdTRFRjZcXHUzMDBDXCIuY29uY2F0KG1hbmlmZXN0LmlkLCBcIlxcdTMwMERcXHU4QkY3XFx1NkM0MlxcdTRFODZcXHU0RTAwXFx1NEUyQVxcdTY3MkFcXHU1QjlBXFx1NEU0OVxcdTc2ODRBUElcXHUzMDBDXCIpLmNvbmNhdChhcGlOYW1lLCBcIlxcdTMwMERcXHVGRjBDXFx1NTZFMFxcdTZCNjRcXHU2MkQyXFx1N0VERFxcdThGN0RcXHU1MTY1XFx1NkI2NFxcdTYzRDJcXHU0RUY2XFx1MzAwMlwiKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsQXBpc0RlZmluZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHVuZGVmaW5lZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsgfSkpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYWxsQXBpc0RlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBcImNvbnRpbnVlXCJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkQXJncyA9IGFyZ3MuZmlsdGVyKGZ1bmN0aW9uIChhcmcpIHsgcmV0dXJuIGFyZyAhPT0gdW5kZWZpbmVkOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRBcmdzLmxlbmd0aCA9PT0gbWFuaWZlc3QucmVxdWVzdGVkQVBJcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdG9tYnN0b25lcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmOiBzZWxmXzEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFuaWZlc3Q6IG1hbmlmZXN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IGZpbHRlcmVkQXJncyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjdXRlZDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2VyLmVycm9yKHsgbWVzc2FnZTogXCJFcnJvciBjcmVhdGluZyBwbHVnaW4gdG9tYnN0b25lIFwiLmNvbmNhdChtYW5pZmVzdC5pZCwgXCI6IFwiKS5jb25jYXQoSlNPTi5zdHJpbmdpZnkoZXJyb3IpKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDRVYyRGlhbG9nLnNob3dEaWFsb2coe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBJMThuLnQoeyBrZXk6ICdyZXF1ZXN0LXJlbG9hZCcgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogXCJcXHU2M0QyXFx1NEVGNlxcdThGN0RcXHU1MTY1XFx1NTY2OFxcdTU3MjhcXHU3NTFGXFx1NjIxMFxcdTYzRDJcXHU0RUY2XFx1MzAwQ1wiLmNvbmNhdChtYW5pZmVzdC5pZCwgXCJcXHUzMDBEXFx1NzY4NFxcdTU4OTNcXHU3ODkxXFx1NEUyRFxcdTUxRkFcXHU3M0IwXFx1OTUxOVxcdThCRUZcIikuY29uY2F0KGVycm9yLCBcIlxcdUZGMENcXHU1NkUwXFx1NkI2NEFjRnVuIEV2b2x2ZWRcXHU1REYyXFx1NEUyRFxcdTZCNjJcXHU4RkQwXFx1ODg0Q1xcdUZGMENcXHU2MzA5XFx1NEUwQlxcdTMwMENcXHU1OTdEXFx1MzAwRFxcdTRFRTVcXHU5MUNEXFx1NjVCMFxcdTU0MkZcXHU1MkE4QWNGdW4gRXZvbHZlZC5cIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2tBY3Rpb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGxvY2F0aW9uLnJlbG9hZCgpOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBfaSA9IDAsIGluc3RhbGxlZFBsdWdpbnNfMiA9IGluc3RhbGxlZFBsdWdpbnM7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKF9pIDwgaW5zdGFsbGVkUGx1Z2luc18yLmxlbmd0aCkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbGVkUGx1Z2luID0gaW5zdGFsbGVkUGx1Z2luc18yW19pXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNSAvKnlpZWxkKiovLCBfbG9vcF8xKGluc3RhbGxlZFBsdWdpbildO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDM7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pKys7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAxXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b21ic3RvbmVzID0gX190b21ic3RvbmVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5mZXJyeW1hbigpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIDtcbiAgICBQbHVnaW5Ub29sa2l0LnByb3RvdHlwZS5mZXJyeW1hbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGV4ZWN1dGVUb21ic3RvbmVzO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVUb21ic3RvbmVzID0gZnVuY3Rpb24gKF9hKSB7IHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIFtfYV0sIHZvaWQgMCwgZnVuY3Rpb24gKF9iKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9fdG9tYnN0b25lcywgX2ksIF9fdG9tYnN0b25lc18xLCB0b21ic3RvbmUsIHNlbGZfMiwgYXJncywgbWFuaWZlc3QsIHJlcXVpcmVkUGF0dGVybnMsIGlzTWF0Y2gsIHRhcmdldEZ1bmN0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSBfYi5jdXJyZW50VXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190b21ic3RvbmVzID0gdGhpcy50b21ic3RvbmVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKF9pID0gMCwgX190b21ic3RvbmVzXzEgPSBfX3RvbWJzdG9uZXM7IF9pIDwgX190b21ic3RvbmVzXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b21ic3RvbmUgPSBfX3RvbWJzdG9uZXNfMVtfaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9tYnN0b25lLmV4ZWN1dGVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZl8yID0gdG9tYnN0b25lLnNlbGYsIGFyZ3MgPSB0b21ic3RvbmUuYXJncywgbWFuaWZlc3QgPSB0b21ic3RvbmUubWFuaWZlc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFuaWZlc3QudHJpZ2dlci5tYXRjaGVzICYmIG1hbmlmZXN0LnRyaWdnZXIubWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRQYXR0ZXJucyA9IG1hbmlmZXN0LnRyaWdnZXIubWF0Y2hlcy5mbGF0TWFwKGZ1bmN0aW9uIChrZXkpIHsgcmV0dXJuIHBhZ2VMaXN0W2tleV0gfHwgW107IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTWF0Y2ggPSByZXF1aXJlZFBhdHRlcm5zLnNvbWUoZnVuY3Rpb24gKHBhdHRlcm4pIHsgcmV0dXJuIHBhdHRlcm4udGVzdChjdXJyZW50VXJsKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dlci5pbmZvKHsgbWVzc2FnZTogXCJleGVjdXRlZCBcIi5jb25jYXQobWFuaWZlc3QuaWQpIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RnVuY3Rpb24gPSBuZXcgKEZ1bmN0aW9uLmJpbmQuYXBwbHkoRnVuY3Rpb24sIF9fc3ByZWFkQXJyYXkoX19zcHJlYWRBcnJheShbdm9pZCAwXSwgYXJncy5tYXAoZnVuY3Rpb24gKGFyZykgeyByZXR1cm4gYXJnLm5hbWU7IH0pLCBmYWxzZSksIFsnbWFuaWZlc3QnLCAnZ2V0U2VsZlByZWZlcmVuY2UnLCBzZWxmXzJdLCBmYWxzZSkpKSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc3QgdGFyZ2V0RnVuY3Rpb24gPSBuZXcgRnVuY3Rpb24oLi4uYXJncy5tYXAoKGFyZzogYW55KSA9PiBhcmcubmFtZSksICdtYW5pZmVzdCcsIGAoKCk9PntcInVzZSBzdHJpY3RcIjsoYXN5bmMoKT0+e2NvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tJyl9KSgpO2ApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RnVuY3Rpb24uYXBwbHkodm9pZCAwLCBfX3NwcmVhZEFycmF5KF9fc3ByZWFkQXJyYXkoW10sIGFyZ3MubWFwKGZ1bmN0aW9uIChhcmcpIHsgcmV0dXJuIGFyZy50YXJnZXQ7IH0pLCBmYWxzZSksIFttYW5pZmVzdCwgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYW5pZmVzdCA9IF9hLm1hbmlmZXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZ2V0U2VsZlByZWZlcmVuY2UoeyBtYW5pZmVzdDogbWFuaWZlc3QgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0sIGZhbHNlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b21ic3RvbmUuZXhlY3V0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dnZXIuZXJyb3IoeyBtZXNzYWdlOiBcIkVycm9yIGZlcnJ5aW5nIHBsdWdpbiBcIi5jb25jYXQobWFuaWZlc3QuaWQsIFwiOiBcIikuY29uY2F0KEpTT04uc3RyaW5naWZ5KGUpKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDRVYyVG9hc3Quc2hvd1RvYXN0KHsgdGV4dDogXCJcXHU2NDQ2XFx1NkUyMVxcdTRFQkFcXHU1NzI4XFx1NjI2N1xcdTg4NENcXHU2M0QyXFx1NEVGNlxcdTMwMENcIi5jb25jYXQobWFuaWZlc3QuaWQsIFwiXFx1MzAwRFxcdTRFMkRcXHU1MUZBXFx1NzNCMFxcdTk1MTlcXHU4QkVGXCIpLmNvbmNhdChKU09OLnN0cmluZ2lmeShlKSwgXCJcXHVGRjBDXFx1NTZFMFxcdTZCNjRcXHU1REYyXFx1NEUyRFxcdTZCNjJcXHU4RkQwXFx1ODg0Q1xcdTZCNjRcXHU2M0QyXFx1NEVGNlxcdTMwMDJcIikgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b21ic3RvbmVzID0gX190b21ic3RvbmVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTsgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGV4ZWN1dGVUb21ic3RvbmVzKHsgY3VycmVudFVybDogd2luZG93LmxvY2F0aW9uLmhyZWYgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBTdXBlcnZpc29yLnVybENoYW5nZShmdW5jdGlvbiAoY3VycmVudFVybCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBleGVjdXRlVG9tYnN0b25lcyh7IGN1cnJlbnRVcmw6IGN1cnJlbnRVcmwgfSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICA7XG4gICAgUGx1Z2luVG9vbGtpdC5wcm90b3R5cGUud2FrZVVwQnVpbGRJblBsdWdpbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChQcmVmZXJlbmNlcy5nZXRQcmVmZXJlbmNlKHsgY2F0ZWdvcnk6ICdkZXZlbG9wZXInLCBrOiAncHN2JyB9KSAhPT0gJ2Z1bGwnKSB7XG4gICAgICAgICAgICBEZWJ1Z0JyaWRnZS53YWtlVXAoKTtcbiAgICAgICAgfVxuICAgICAgICBQbHVnaW5TdG9yZS53YWtlVXAoKTtcbiAgICB9O1xuICAgIFBsdWdpblRvb2xraXQucHJvdG90eXBlLmV4dHJhY3RBbmRJbnN0YWxsUGx1Z2luID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBjb21wcmVzc2VkRGF0YSA9IF9hLmNvbXByZXNzZWREYXRhO1xuICAgICAgICBBQ0VWMkRpYWxvZy5zaG93RGlhbG9nKHtcbiAgICAgICAgICAgIHRpdGxlOiBJMThuLnQoeyBrZXk6IEkxOG4udCh7IGtleTogJ3dhbnRzLXRvLWV4dHJhY3QtYW5kLWluc3RhbGwtcGx1Z2luLXBhY2thZ2UnIH0pIH0pLFxuICAgICAgICAgICAgY29udGVudDogSTE4bi50KHsga2V5OiAnZG8teW91LXJlYWxseS13YW50LXRvLWRvLXRoYXQnIH0pLFxuICAgICAgICAgICAgb2tBY3Rpb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVjb21wcmVzc2VkQXJyYXlCdWZmZXIsIGZpbGVzLCByYXdPYmplY3QsIHBhY2ssIGVycl8xO1xuICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDRVYyTG9hZGVyLmRyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsxLCAzLCAsIDRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNvbXByZXNzZWRBcnJheUJ1ZmZlciA9IHBha28uaW5mbGF0ZShuZXcgVWludDhBcnJheShjb21wcmVzc2VkRGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGVjb21wcmVzc2VkQXJyYXlCdWZmZXIuYnVmZmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDRVYyVG9hc3Quc2hvd1RvYXN0KHsgdGV4dDogSTE4bi50KHsga2V5OiAnZGVjb21wcmVzc2VkLWRhdGEtZG9lcy1ub3QtY29udGFpbi12YWxpZC1idWZmZXItcHJvcGVydHknIH0pIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzID0gdW50YXIoZGVjb21wcmVzc2VkQXJyYXlCdWZmZXIuYnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVzIHx8IGZpbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBQ0VWMlRvYXN0LnNob3dUb2FzdCh7IHRleHQ6IEkxOG4udCh7IGtleTogJ25vLWZpbGVzLWV4dHJhY3RlZC1mcm9tLXRoZS1jb21wcmVzc2VkLWRhdGEnIH0pIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhd09iamVjdCA9IGZpbGVzWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhd09iamVjdCA9IG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShyYXdPYmplY3QuZmlsZURhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2sgPSBKU09OLnBhcnNlKHJhd09iamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5pbnN0YWxsUGx1Z2luKHsgcGx1Z2luUGFjazogcGFjaywgYnJpZGdlZDogZmFsc2UgfSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJfMSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dnZXIuZXJyb3IoeyBtZXNzYWdlOiBcIkVycm9yIGV4dHJhY3RpbmcgYW5kIGluc3RhbGxpbmcgcGx1Z2luIHBhY2thZ2U6IFwiLmNvbmNhdChKU09OLnN0cmluZ2lmeShlcnJfMSkpIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDRVYyVG9hc3Quc2hvd1RvYXN0KHsgdGV4dDogSTE4bi50KHsga2V5OiAnZXJyb3ItZXh0cmFjdGluZy1hbmQtaW5zdGFsbGluZy1wbHVnaW4tcGFja2FnZScgfSkgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQUNFVjJMb2FkZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7IH0sXG4gICAgICAgICAgICBjYW5jZWxBY3Rpb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIEFDRVYyVG9hc3Quc2hvd1RvYXN0KHsgdGV4dDogJ2NhbmNlbGVkJyB9KTsgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIDtcbiAgICBQbHVnaW5Ub29sa2l0LnByb3RvdHlwZS5kb3dubG9hZEFuZEluc3RhbGxQbHVnaW5QYWNrID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBtYW5pZmVzdCA9IF9hLm1hbmlmZXN0O1xuICAgICAgICB2YXIgZnVsbERvd25sb2FkVXJsID0gVmFyaWFibGUucGx1Z2luRG93bmxvYWRVUkwoeyBtYW5pZmVzdDogbWFuaWZlc3QgfSk7XG4gICAgICAgIEFDRVYyRGlhbG9nLnNob3dEaWFsb2coe1xuICAgICAgICAgICAgdGl0bGU6IFZhcmlhYmxlLk1BU1RFUl9NQU5JRkVTVC5pZCArICcgJyArIEkxOG4udCh7IGtleTogJ3dhbnRzLXRvLWRvd25sb2FkLWFuZC1pbnN0YWxsLXBsdWdpbi1wYWNrYWdlJyB9KSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IEkxOG4udCh7IGtleTogJ2Rvd25sb2FkLXVybCcgfSkgKyAnOiBbJyArIGZ1bGxEb3dubG9hZFVybCArICddIHwgJyArIEkxOG4udCh7IGtleTogJ3RhcmdldC1wbHVnaW4taWQnIH0pICsgbWFuaWZlc3QuaWQsXG4gICAgICAgICAgICBva0FjdGlvbjogZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBjb21wcmVzc2VkUGFjaywgZGVjb21wcmVzc2VkQ29udGVudCwgZmlsZXMsIHJhd09iamVjdCwgcGFjaywgZXJyXzI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQUNFVjJMb2FkZXIuZHJhdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIElPLm1vbmtleSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBmdWxsRG93bmxvYWRVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXByZXNzZWRQYWNrID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzIsIDQsICwgNV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY29tcHJlc3NlZENvbnRlbnQgPSBwYWtvLmluZmxhdGUoY29tcHJlc3NlZFBhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzID0gdW50YXIoZGVjb21wcmVzc2VkQ29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF3T2JqZWN0ID0gZmlsZXNbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFjayA9IEpTT04ucGFyc2UobmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKHJhd09iamVjdC5maWxlRGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuaW5zdGFsbFBsdWdpbih7IHBsdWdpblBhY2s6IHBhY2ssIGJyaWRnZWQ6IGZhbHNlIH0pXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyXzIgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQUNFVjJUb2FzdC5zaG93VG9hc3QoeyB0ZXh0OiBJMThuLnQoeyBrZXk6ICdlcnJvci1leHRyYWN0aW5nLWFuZC1pbnN0YWxsaW5nLXBsdWdpbi1wYWNrYWdlJyB9KSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfop6PljovnvKnlpLHotKUnLCBlcnJfMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQUNFVjJMb2FkZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7IH0sXG4gICAgICAgICAgICBjYW5jZWxBY3Rpb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIEFDRVYyVG9hc3Quc2hvd1RvYXN0KHsgdGV4dDogSTE4bi50KHsga2V5OiAnY2FuY2VsZWQnIH0pIH0pOyB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFBsdWdpblRvb2xraXQ7XG59KCkpO1xuZXhwb3J0IGRlZmF1bHQgbmV3IFBsdWdpblRvb2xraXQoKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/core/api/PluginToolkit.ts\n");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("7d64965ab2a95eaa954e")
/******/ })();
/******/ 
/******/ }
);